{% extends "layouts/base.html" %}

{% block title %} Intelligent Classifier {% endblock %}

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}
<style>
          thead th {
            color: white;
        }
        td
        { color:white;
        }
        .data-table tbody tr td:not(:has(input[type="checkbox"])) {
            cursor: pointer;
            transition: transform 0.3s ease;  /* Add a smooth transition effect */
        }

        .data-table tbody tr td.active:not(:has(input[type="checkbox"])) {
            transform: scale(2);  /* Adjust the magnification factor as needed */
        }


  .flipswitch {
  position: relative;
  background: white;
  width: 120px;
  height: 40px;
  -webkit-appearance: initial;
  border-radius: 3px;
  -webkit-tap-highlight-color: rgba(0, 0, 0, 0);
  outline: none;
  font-size: 10px;
  font-family: Trebuchet, Arial, sans-serif;
  font-weight: bold;
  cursor: pointer;
  border: 1px solid #ddd;
}

.flipswitch:after {
  position: absolute;
  top: 5%;
  display: block;
  line-height: 32px;
  width: 45%;
  height: 90%;
  background: #fff;
  box-sizing: border-box;
  text-align: center;
  transition: all 0.3s ease-in 0s;
  color: black;
  border: #888 1px solid;
  border-radius: 3px;
}
.flipswitch:checked:after {
  left: 53%;
  content: "IRRELEVANT";
  background:red;

}
.flipswitch:after {
  left: 2%;
  content: "RELEVANT";
  background:green;

}


.fancy-header {
      background-color: rgba(0, 0, 0, 0.7); /* Semi-transparent black background */
      color: #fff;
      padding: 20px;
      text-align: center;
    }
    .fancy-header h1 {
      font-size: 36px;
      margin-bottom: 0;
    }
    .fancy-header p {
      font-size: 18px;
    }





    </style>


{% endblock stylesheets %}

{% block content %}
<div class = "content">
<div class="container-fluid fancy-header">
  <div class="container">
    <div class="row">
      <div class="col-md-6">
        <h1 id = "sessionNo" name = "{{ session['logging_id'] }}">Experiment NO {{ session['logging_id'] }}</h1>
        <p>These are the results for the keywords : {{ session['keywords'] }}</p>

    </div>
  </div>
</div>
</div>
 <button id="saveButton" class="btn btn-primary" onclick="saveToDatabase()">Save to Database</button>
<!-- Your Bootstrap table -->
<div class="container mt-5 data-table">
    <!-- Insert the generated HTML table here -->
    <table id = "codesTable" class="table table-bordered table-striped text-center">
        <thead >
            <tr>
                <th scope="col">Codes</th>
                <th scope="col">Relevant/Irrelevant</th>
            </tr>
        </thead>
        <tbody>
            {% for index, row in dataframe.iterrows() %}
            <tr>
                <td>{{ row['Codes'] }}</td>
                <td>
                    <input type="checkbox" id="checkbox{{ loop.index }}" name="checkbox{{ loop.index }}" class = "flipswitch" data-target="value{{ loop.index }}">
                    <label id="value{{ loop.index }}" style="display: none;" data-value="1">1</label>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
<!-- Modal structure -->
<!-- Modal structure -->
<div id="myModal" class="modal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Cell Content</h5>
                <button type="button" class="close" data-dismiss="modal">&times;</button>
            </div>
            <div class="modal-body" id="modalContent"></div>
        </div>
    </div>
</div>

{% endblock content %}

<!-- Specific Page JS goes HERE  -->
{% block javascripts %}
<script>
    // Plain JavaScript function to handle button click
// Plain JavaScript function to handle button click
function saveToDatabase() {
    // Collect data from the table
    var sessionID =document.getElementById('sessionNo').getAttribute("name");
    var tableData = [];
    var rows = document.getElementById('codesTable').getElementsByTagName('tr');
    for (var i = 1; i < rows.length; i++) { // Start from index 1 to skip header row
        var code = rows[i].getElementsByTagName('td')[0].textContent;
        const labelId = '#value' + i;

        var relevance = rows[i].querySelector(labelId).innerHTML;

        tableData.push({id:sessionID, code: code, relevance: relevance });
    }

    // Send data to backend
    fetch('/save_to_database', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: JSON.stringify(tableData)
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Failed to save data to database');
        }
        console.log('Data saved successfully');
    })
    .catch(error => {
        console.error('Error:', error);
    });

    // Retrieve authenticated user information (if available)
    var authenticatedUser = localStorage.getItem('authenticatedUser');
    console.log('Authenticated user:', authenticatedUser);
}

   // Add click event to each cell using jQuery
$(document).on('click', '.data-table tbody tr td:not(:has(input[type="checkbox"]))', function() {
    // Your custom logic when a cell is clicked
    console.log('Clicked:', $(this).text());

    // Show modal with cell content
    showModal(this);
});


    // Add mouseover and mouseout events to toggle the 'active' class
    $(document).on('mouseover', '.data-table tbody tr td', function() {
        $(this).addClass('active');
    });

    $(document).on('mouseout', '.data-table tbody tr td', function() {
        $(this).removeClass('active');
    });

    // Show modal function
    function showModal(cell) {
        var modalContent = $('#modalContent');
        modalContent.empty();  // Clear existing content

        // Add content to modal (you can customize this part)
        modalContent.text($(cell).text());

        // Show the modal using Bootstrap modal methods
        $('#myModal').modal('show');
    }
   function toggleCheckmark(checkbox) {
   //checkbox.checked = !checkbox.checked;
    // Find the parent row of the checkbox
    //var row = checkbox.closest('tr');

    // Find the checkmark span in the row
    //var checkmark = row.querySelector('.checkmark');

    //if (checkmark) {
        // Get the result type from the checkbox's data-result attribute
      //  var resultType = checkbox.getAttribute('data-result');

        // Update checkmark content based on result type
      //  checkmark.innerHTML = (resultType === 'success') ? '✔️' : '❌';
   // } else {
        // Create a new checkmark span
        //var checkmark = document.createElement('span');
        //checkmark.className = 'checkmark';

        // Get the result type from the checkbox's data-result attribute
       // var resultType = checkbox.getAttribute('data-result');

        // Set checkmark content based on result type
       // checkmark.innerHTML = (resultType === 'success') ? '✔️' : '❌';

        // Append checkmark span after the checkbox
        //checkbox.parentNode.appendChild(checkmark);
    }
document.addEventListener('change', function(event) {
  if (event.target.classList.contains('flipswitch')) {
    const checkbox = event.target;
    const valueLabelId = checkbox.getAttribute('data-target');
    const valueLabel = document.getElementById(valueLabelId);

    if (checkbox.checked) {
      valueLabel.innerHTML = '2';
    } else {
      valueLabel.innerHTML = '1';
    }

    const dataValue = valueLabel.innerHTML;
    console.log(dataValue); // Output: The value of the data-value attribute
  }
});

</script>
{% endblock javascripts %}
