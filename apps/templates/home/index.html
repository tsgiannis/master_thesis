{% extends "layouts/base.html" %}

{% block title %} Intelligent Classifier {% endblock %}

<!-- Specific Page CSS goes HERE  -->
{% block stylesheets %}
<style xmlns="http://www.w3.org/1999/html">
    @media only screen and (max-width: 600px) {
  #keywords {
        width: 90%; /* Take full width of the screen */
        font-size: 14px;
        padding: 10px 10px 10px 20px;/* Adjust font size for smaller screens */
  }
}

    .modalWindow {
    display: none; /* Hidden by default */
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    background-color: rgba(0, 0, 0, 0.5);
    padding: 20px;
    border-radius: 10px;
    z-index: 1000;
    color: white;
  }



    .toggle-btn {
    position: relative;
    display: inline-block;
    width: 60px;
    height: 30px;
    border-radius: 15px;
    background-color: #ddd;
    cursor: pointer;
    transition: background-color 0.3s;
  }

  .toggle-btn .slider {
    position: absolute;
    top: 2px;
    left: 2px;
    width: 26px;
    height: 26px;
    border-radius: 50%;
    background-color: #fff;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
    transition: transform 0.3s;
  }

  /* Toggle Button Checked State */
  .toggle-btn.checked {
    background-color: #4cd964; /* Green color, you can change it */
  }

  .toggle-btn.checked .slider {
    transform: translateX(30px);
  }

  /* Hide Checkbox */
  .toggle-btn input[type="checkbox"] {
    visibility: hidden;
  }
    .custom-btn-size {
        font-size: 36px;
    }

    /* Custom background color for the modal content */
    .custom-modal-content {
        background-color: #fff666; /* Red color */
    }

    .toggle {
        cursor: pointer;
        display: inline-block;
    }

    .toggle-switch {
        display: inline-block;
        background: linear-gradient(to top, #fff1eb 0%, #ace0f9 100%);
        border-radius: 16px;
        width: 58px;
        height: 32px;
        position: relative;
        vertical-align: middle;
        transition: background 0.25s;
    }

    .toggle-switch:before, .toggle-switch:after {
        content: "";
    }

    .toggle-switch:before {
        display: block;
        background: linear-gradient(to top, #09203f 0%, #537895 100%);
        border-radius: 50%;
        box-shadow: 0 0 0 1px rgba(0, 0.25, 0, 0.25);
        width: 24px;
        height: 24px;
        position: absolute;
        top: 4px;
        left: 4px;
        transition: left 0.25s;
    }

    .toggle:hover .toggle-switch:before {
        background: linear-gradient(to bottom, #fff 0%, #fff 100%);
        box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.5);
    }

    .toggle-checkbox:checked + .toggle-switch {
        background: linear-gradient(179.1deg, rgb(43, 170, 96) 2.3%, rgb(129, 204, 104) 98.3%);
    }

    .toggle-checkbox:checked + .toggle-switch:before {
        left: 30px;
    }

    .toggle-checkbox {
        position: absolute;
        visibility: hidden;
    }

    .toggle-label {
        margin-left: 5px;
        position: relative;
        top: 2px;
    }

    hr {
        margin-top: 1rem;
        margin-bottom: 1rem;
        border: 0;
        border-top: 1px solid rgba(255, 230, 255, 0.2);
    }

    .wrap-text-btn {
        white-space: normal;
    }

    .meaningful-word {
        color: green !important;
    }

    .meaningless-word {
        color: red;
    }

    .custom-dropdown {
        width: 90%;
    }

    a.disabled {
        pointer-events: none;
    }

    .custom-margin {
        margin-right: 5px; /* Adjust the value as needed */
    }

    .btn-custom {
        display: flex;
        width: 96%;


    }



/* CUSTOM CSS DROPDOWN-MENU
/* Dropdown Button */
.dropbtn {
  background-color: #3498db;
  color: white;
  padding: 12px;
  font-size: 16px;
  border: none;
  cursor: pointer;
  width: 80%; /* Set a wider width */
  position: relative;
  border-radius: 10px; /* Add rounded corners */
  text-align: left;
}

/* Dropdown Content (Hidden by Default) */
.dropdown-content {
  display: none;
  position: absolute;
  background-color: #f9f9f9;
  width: 220px; /* Set a wider width */
  box-shadow: 0 8px 16px 0 rgba(0,0,0,0.2);
  z-index: 1;
  border-radius: 10px; /* Add rounded corners */
  transform: translate(0, 5px); /* Add 3D effect */
  text-align: center; /* Align options center */
}

/* Links inside the dropdown */
.dropdown-content a {
  color: black;
  padding: 12px 16px;
  text-decoration: none;
  display: block;
}





/* Arrow on the right side */
.dropbtn::after {
  content: '';
  position: absolute;
  top: 50%;
  right: 12px;
  transform: translateY(-50%);
  border: 8px solid transparent;
  border-top-color: white; /* Arrow points downwards */
}

/* Disabled option */
.dropdown-content a.disabled {
  color: #ccc;
  pointer-events: none; /* Disable clicking */
}
/* Style for button */
#readFileBtn {
  padding: 10px 20px;
  background-color: #3498db;
  color: white;
  border: none;
  border-radius: 5px;
  cursor: pointer;
}

/* Initially hide the dropdown content */
.dropdown-content {
    display: none;
}
.hidden_default
{
    display: none;
}
/* Show the dropdown content when the 'show' class is added */
.dropdown-content.show {
    display: block;
}
.custom-button {
    display: inline-block;
    padding: 10px 20px;
    background-color: #007bff;
    color: #fff;
    border: none;
    border-radius: 5px;
    cursor: pointer;
    text-align: center;
}

.custom-button:hover {
    background-color: #0056b3;
}

</style>


{% endblock stylesheets %}

{% block content %}

<div class="content">
    <!-- Button to remind the user to input keywords -->
    <!-- Button to mark the end of user input -->
    <button id="inputComplete" class="btn btn-primary" onclick="completeUserInput()"
            style="position: fixed; top: 50px; right: 100px; display: none;">Input Complete
    </button>


    {% if selected_option %}
    <div class="alert alert-success" role="alert">
        {{ selected_option }}
    </div>
    {% endif %}
    <div class="modal" id="selections_checker" tabindex="-1" role="dialog">
        <div class="modal-dialog custom-modal-content" role="document">
            <div class="modal-content custom-modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Selection Checker</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- Content for the modal -->
                    <p>You missed to select all the options</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>
    <div class="modal" id="keywords_checker" tabindex="-1" role="dialog">
        <div class="modal-dialog custom-modal-content" role="document">
            <div class="modal-content custom-modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Keywords Checker</h5>
                    <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                        <span aria-hidden="true">&times;</span>
                    </button>
                </div>
                <div class="modal-body">
                    <!-- Content for the modal -->
                    <p>You missed to enter Keywords</p>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                </div>
            </div>
        </div>
    </div>

    <div class="container mt-5" id = "InputSelections">
        <div class="row justify-content-center">
            <div class="col-md-10">
                <div class="input-group mb-3">
                    <div class="input-group-prepend">
                        <span class="input-group-text" style="background-color: blue; color: white; text-align: left;padding:10px;">Enter Keywords</span>
                    </div>
                    <input type="text" class="form-control" placeholder="Keywords" id="keywords"  style="height: 60px;">
                    <div class="input-group-append">
                        <button class="btn btn-outline-secondary" type="button" onclick = "uploadFile()">Upload File</button>
                    </div>
                </div>
                <div class="row">
                    <div class="col">
                        <button class="btn btn-primary" onclick = "keyword_processing()">Check Functionality</button>
                    </div>
                    <div class="col">
                        <button class="btn btn-danger btn-block" onclick="CheckNRun()" type="submit">Search</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-md-6 hidden_default modalWindow" id="wordTable">

                    <table class="table">
                        <thead>
                        <tr>
                            <th>Included keyWords</th>
                            <th>Excluded keyWords</th>
                        </tr>
                        </thead>
                        <tbody>
                        <!-- Add rows with good and bad words dynamically here -->
                        </tbody>
                    </table>
                <button class = " btn btn-outline-secondary" onclick="closeModalWordTable()">Close</button>

            </div>
    <hr/>
    <!-- Modal -->
    <div class="modal" id="resultsToDisplay" style="display: none;">
        <div class="modal-dialog">
            <div class="modal-content">

                <!-- Modal Header -->
                <div class="modal-header">
                    <h4 class="modal-title">Results Selector</h4>
                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                </div>

                <!-- Modal Body -->
                <div class="modal-body">
                    <p>Please select No of Results to Display:</p>
                    <div class="btn-group" role="group">
                        <button type="button" class="btn btn-secondary mr-2">3</button>
                        <button type="button" class="btn btn-secondary mr-2">5</button>
                        <button type="button" class="btn btn-secondary mr-2">10</button>
                        <button type="button" class="btn btn-secondary mr-2">all</button>
                    </div>
                </div>

            </div>
        </div>
    </div>
    <hr>
      <div>
        <ul class="ml-auto">
            <li class="input-group d-flex align-items-center mb-0">
                <label class="toggle">
                    <input class="toggle-checkbox" type="checkbox" id="toggle-advanced" onclick="toggleDiv()">
                    <div class="toggle-switch"></div>
                    <span class="toggle-label" id="toggleAdvanced">Advanced</span>
                </label>
            </li>
        </ul>
    </div>




    <!-- **** COMPACT VIEW START *****  -->
    <div id="compactview" class = "hidden_default">


        <div class="container mt-4 text-center">
            <div class="row justify-content-center">
                <!-- ************************************ -->
                <!-- Machine Learning Methods -->
                <!-- Row 1 -->
                <div class="col-md-6">
                    <form id='form_compact_methods'>
                        <div class="form-group row align-items-center">
                            <label for="inputState_methods_compact"
                                   class="col-sm-4 col-form-label text-center bg-success font-weight-bold"
                                   style="height: 10%;">Machine Learning Methods</label>
                            <div class="col-md-8 h-80">

                                <div class="dropdown"     >
                                    <button id="selected_methods" class="dropbtn" onclick="toggleDropdown(this)">Select a ML Method</button>
                                    <div class="dropdown-content">
                                        {% for item in session['methods'] %}
                                        {% if item['name'].lower() not in session['dynamic.methods'] %}
                                        <a href="#" data-value="{{ item['name'] }}" class="disabled">{{ item['name']
                                            }}</a>

                                        {% else %}
                                        <a href="#" data-value="{{ item['name'] }}" onclick="selectedOption(this)">{{
                                            item['name'] }}</a>
                                        {% endif %}
                                        {% endfor %}

                                    </div>
                                </div>

                            </div>
                        </div>
                    </form>
                </div>

            </div>
            <div class="row justify-content-center">
                <!-- ************************************ -->
                <!-- Language Models -->
                <!-- Row 2 -->
                <div class="col-md-6">
                    <form id='form_compact_languagemodels'>
                        <div class="form-group row align-items-center">
                            <label for="inputState_languagemodels_compact"
                                   class="col-sm-4 col-form-label text-center bg-success font-weight-bold"
                                   style="height: 10%;">Language Models</label>
                            <div class="col-md-8 h-80">

                                <div class="dropdown_methods" >
                                    <button id="selected_languagemodels" class="dropbtn" onclick="toggleDropdown(this)">Select a Language Model</button>
                                    <div class="dropdown-content">
                                        {% for item in session['languagemodels'] %}
                                        {% if item['name'].lower() not in session['dynamic.languagemodels'] %}
                                        <a href="#" data-value="{{ item['name'] }}" class="disabled">{{
                                            item['display_name'] }}</a>

                                        {% else %}
                                        <a href="#" data-value="{{ item['name'] }}" onclick="selectedOption(this)">{{
                                            item['display_name'] }}</a>
                                        {% endif %}
                                        {% endfor %}

                                    </div>
                                </div>

                            </div>
                        </div>
                    </form>
                </div>

            </div>
            <!-- ************************************ -->



            <!-- ************************************ -->
            <div class="container mt-4 text-center">
                <!-- Row 3 datasets/sections -->
                <div class="row justify-content-center">
                    <div class="col-md-8"> <!-- Adjust the width of the column as needed -->
                        <form id='form_compact_datasets'>
                            <div class="form-group row">
                                <label for="inputState_datasets_compact"
                                       class="col-sm-4 col-form-label text-center bg-success font-weight-bold ">Datasets/Sections</label>
                                <div class="col-md-8">

                                    <div class="d-flex"> <!-- Use flex utilities for alignment -->
                                        <div id = "dropdown_datasets" class="dropdown" >
                                <button id="selected_datasets" class="dropbtn" onclick="toggleDropdown(this)">Select a Dataset</button>
                                <div class="dropdown-content">
                                    {% for item in session['datasets'] %}
                                    {% if item['name'].lower() not in session['dynamic.datasets'] %}
                                    <a href="#" data-value="{{ item['name'] }}" class="disabled">{{ item['display_name']
                                        }}</a>

                                    {% else %}
                                    <a href="#" data-value="{{ item['name'] }}" onclick="selectedOption(this);getFilteredOptions(this)">{{
                                        item['display_name'] }}</a>
                                    {% endif %}
                                    {% endfor %}

                                </div>
                            </div>
                                        <div class="dropdown_sections" >
                                <button id="selected_sections" class="dropbtn" onclick="toggleDropdown(this)">Select an Section</button>
                                <div class="dropdown-content" id="sections">
                                    <p Please Select the Corresponding dataset></p>

                                </div>
                            </div>
                                    </div>

                                </div>
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>


        <div class="row mt-2 justify-content-center">
            <!-- Row 4 -->
            <!-- IPC Levels -->
            <div class="col-md-6">
                <form id='form_compact_ipclevels'>
                    <div class="form-group row align-items-center">
                        <label for="inputState_ipclevels_compact"
                               class="col-sm-4 col-form-label text-center bg-info font-weight-bold"
                               style="height: 16%;">IPC Levels</label>
                        <div class="col-md-8 h-80">
                            <div class="dropdown" >
                                <button id="selected_ipclevels" class="dropbtn" onclick="toggleDropdown(this)">Select an IPC Level</button>
                                <div class="dropdown-content">
                                    {% for item in session['ipclevels'] %}
                                    {% if item['name'].lower() not in session['dynamic.ipclevels'] %}
                                    <a href="#" data-value="{{ item['name'] }}" class="disabled">{{ item['display_name']
                                        }}</a>

                                    {% else %}
                                    <a href="#" data-value="{{ item['name'] }}" onclick="selectedOption(this)">{{
                                        item['display_name'] }}</a>
                                    {% endif %}
                                    {% endfor %}

                                </div>
                            </div>
                        </div>
                    </div>
                </form>

            </div>
        </div>

        <div class="row mt-2 justify-content-center">
            <!-- ************************************ -->
            <!-- Νο Of Words -->
            <!-- Row 6 -->
            <div class="col-md-6">
                <form id='form_compact_noofwords'>
                    <div class="form-group row align-items-center">
                        <label for="inputState_noofwords_compact"
                               class="col-sm-4 col-form-label text-center bg-info font-weight-bold"
                               style="height: 16%;">Number of Words</label>
                        <div class="col-md-8 h-80">
                            <div class="dropdown" >
                                <button id="selected_noofwords" class="dropbtn" onclick="toggleDropdown(this)">Select No Of Words</button>
                                <div class="dropdown-content">
                                    {% for item in session['noofwords'] %}
                                    {% if item['value'] not in session['dynamic.noofwords'] %}
                                    <a href="#" data-value="{{ item['value'] }}" class="disabled">{{ item['value']
                                        }}</a>

                                    {% else %}
                                    <a href="#" data-value="{{ item['value'] }}" onclick="selectedOption(this)">{{
                                        item['value'] }}</a>
                                    {% endif %}
                                    {% endfor %}

                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <div class="row mt-2 justify-content-center">
            <!-- ************************************ -->
            <!-- Single / Multi label -->
            <!-- Row 7 -->
            <div class="col-md-6">
                <form id='form_compact_singlemulti'>
                    <div class="form-group row align-items-center">
                        <label for="inputState_singlemulti_compact"
                               class="col-sm-4 col-form-label text-center bg-info font-weight-bold"
                               style="height: 16%;">Single / Multi</label>
                        <div class="col-md-8 h-80">
                            <div class="dropdown" >
                                <button id="selected_singlemulti" class="dropbtn" onclick="toggleDropdown(this)">Select Single/Multi</button>
                                <div class="dropdown-content">
                                    {% for item in session['singlemulti'] %}
                                    {% if item['name'] not in session['dynamic.singlemulti'] %}
                                    <a href="#" data-value="{{ item['name'] }}" class="disabled">{{ item['name']
                                        }}</a>

                                    {% else %}
                                    <a href="#" data-value="{{ item['name'] }}" onclick="selectedOption(this)">{{
                                        item['name'] }}</a>
                                    {% endif %}
                                    {% endfor %}

                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
        </div>
        <div class="row mt-2 justify-content-center">
            <!-- ************************************ -->
            <!-- Structure -->
            <!-- Row 8 -->
            <div class="col-md-6">
                <form id='form_compact_structure'>
                    <div class="form-group row align-items-center">
                        <label for="inputState_structure_compact"
                               class="col-sm-4 col-form-label text-center bg-info font-weight-bold"
                               style="height: 16%;">Structure</label>
                        <div class="col-md-8 h-80">
                            <div class="dropdown" >
                                <button id="selected_structure" class="dropbtn" onclick="toggleDropdown(this)">Select Structure</button>
                                <div class="dropdown-content">
                                    {% for item in session['structures'] %}
                                    {% if item['name'] not in session['dynamic.structures'] %}
                                    <a href="#" data-value="{{ item['name'] }}" class="disabled">{{ item['name']
                                        }}</a>

                                    {% else %}
                                    <a href="#" data-value="{{ item['name'] }}" onclick="selectedOption(this)">{{
                                        item['name'] }}</a>
                                    {% endif %}
                                    {% endfor %}

                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>

        </div>
        <div class="row mt-2 justify-content-center">
            <!-- ************************************ -->
            <!-- Ensemble -->

            <!-- Row 9 -->
            <div class="col-md-6">
                <form id='form_compact_ensemble'>
                    <div class="form-group row">
                        <label for="ensemble_compact"
                               class="col-sm-4 col-form-label text-center bg-danger font-weight-bold">Ensemble</label>
                        <div class="col-md-8 h-80">
                            <div class="dropdown" >
                                <button id="selected_ensemble" class="dropbtn" onclick="toggleDropdown(this)">Select Ensemble</button>
                                <div class="dropdown-content">
                                    {% for item in session['ensemble'] %}
                                    {% if item['name'] not in session['dynamic.ensemble'] %}
                                    <a href="#" data-value="{{ item['name'] }}" class="disabled">{{ item['name']
                                        }}</a>

                                    {% else %}
                                    <a href="#" data-value="{{ item['name'] }}" onclick="selectedOption(this)">{{
                                        item['name'] }}</a>
                                    {% endif %}
                                    {% endfor %}

                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>

        </div>
         <form id="runForm" method="POST" action="{{ url_for('home_blueprint.routename') }}">
    <!-- Include any form fields as needed -->

    <!-- Fancy RUN button inside the form -->
    <button type="button" class="btn btn-danger  btn-lg btn-block custom-btn-size" onclick="CheckNRun()" type="submit">
        SEARCH
    </button>
</form>
    </div>
    <!-- *****  COMPACT VIEW END  ******  -->

</div>
<hr/>



{% endblock content %}

<!-- Specific Page JS goes HERE  -->
{% block javascripts %}

<script>
    function handleToggleView() {
        var toggleview = document.getElementById('toggle-view');
        var compactview = document.getElementById('compactview');
        var fullview = document.getElementById('fullview');
        var toggleinfo = document.getElementById('toggleinfo');
        //fullview.style.display = 'none';

        toggleview.onchange = function () {
            if (toggleview.checked) {
                compactview.style.display = 'none';
                fullview.style.display = 'block';
                toggleinfo.innerHTML = "Full"
            } else {
                fullview.style.display = 'none';
                compactview.style.display = 'block';
                toggleinfo.innerHTML = "Compact"

            }
        };
    }


    // Hide the button initially
    document.getElementById('inputComplete').style.display = 'none';

    var selections = [];

    function showInputCompleteButton() {
        document.getElementById('inputComplete').style.display = 'block';
    }

    function hideInputCompleteButton() {
        document.getElementById('inputComplete').style.display = 'none';
    }

    function getFilteredOptions(item) {
        var selectedValue = item.getAttribute('data-value')
        var xhr = new XMLHttpRequest();
        xhr.open('POST', '/get_filtered_options', true);
        xhr.setRequestHeader('Content-Type', 'application/json');
        xhr.onreadystatechange = function () {
            if (xhr.readyState === XMLHttpRequest.DONE && xhr.status === 200) {
               document.getElementById('sections').innerHTML = xhr.responseText;
            }
        };
        xhr.send(JSON.stringify({selectedValue: selectedValue}));
    }

    function readFile(event) {
            var openFile = function(event) {
  var input = event.target;

  var reader = new FileReader();
  reader.onload = function() {
    var text = reader.result;
    var node = document.getElementById('output');
    node.innerText = text;
    console.log(reader.result.substring(0, 200));
  };
  reader.readAsText(input.files[0]);
};
        }

    function addToCollection(collection, key, value) {
        // Check if the key already exists in the collection
        for (var i = 0; i < collection.length; i++) {
            var pair = collection[i];
            if (key in pair) {
                // Update the existing value for the key
                pair[key] = value;
                return;  // Exit the function after updating
            }
        }

        // If the key doesn't exist, add a new key-value pair
        if (collection.length < 11) {
            var newPair = {};
            newPair[key] = value;
            collection.push(newPair);
        } else {
            console.log('Collection already has 11 pairs. Cannot add more.');
        }
    }


    function showGenre(item) {
        document.querySelectorAll('form').forEach(function (form) {
            form.querySelectorAll('.dropdown-item.active').forEach(function (item) {
                var value = item.getAttribute('data-value');
                var key = item.parentElement.attributes('name')
                addToCollection(selections, key, value)
            })
        })
    }

    function handleDropdownItemClick(item) {
        // Remove the 'active' class from all items
        var form = item.closest('form');

        if (form) {
            // Remove the 'active' class from all items within the form
            var dropdownItems = form.querySelectorAll('.dropdown-item');
            dropdownItems.forEach(function (item) {
                item.classList.remove('active');
            });

            // Add the 'active' class to the clicked item
            item.classList.add('active');
            var activeItemText = item.textContent;
            var value = activeItemText;
            // Get the text content of the active item
            if (item.getAttribute('value') !== null) {
                value = item.value.toLowerCase();
            }


            var key = item.parentElement.attributes.name.textContent
            if (key.indexOf('_compact') > 0) {
                key_for_collection = key.substring(0, key.indexOf('_compact'))
            } else
                key_for_collection = key

            addToCollection(selections, key_for_collection, value)
            document.getElementById('span_' + key).textContent = activeItemText
        } else {
            console.log('No form found.');
        }


    }

    function showResultsModal() {
        return new Promise(function (resolve, reject) {
            $('#resultsToDisplay').modal('show');

            // Event listener for the buttons in the modal
            $('#resultsToDisplay .btn').click(function () {
                var selectedOption = $(this).text().trim(); // Get the text of the clicked button
                $('#resultsToDisplay').modal('hide');
                console.log("Selected option:", selectedOption);
                resolve(selectedOption); // Resolve the promise with the selected option
            });

            // Close the modal after 5 seconds if no selection is made
            var timeoutId = setTimeout(function () {
                $('#resultsToDisplay').modal('hide');
                var defaultOption = '3';
                console.log("No selection made within 3 seconds. Resolving with default value:", defaultOption);
                resolve(defaultOption); // Resolve with default value after timeout
            }, 5000);
        });
    }

    function waitForKeywords(callback) {
        var intervalId = setInterval(function () {
            var keywords = document.getElementById('keywords').value.trim();
            if (keywords !== '') {
                clearInterval(intervalId); // Stop the interval
                callback(keywords); // Call the callback with the keywords
            }
        }, 1000); // Check every second
    }

    // Function to handle the completion of user input
    function completeUserInput() {
        hideInputCompleteButton(); // Hide the button
        hideKeywordsMissingModal(); // Hide any alert modal
        processSelections(); // Process the selections
    }

    // Function to show the alert modal for missing keywords
    function showAlertModal() {
        // Show your alert modal implementation here
    }

    // Function to hide the alert modal
    function hideAlertModal() {
        // Hide your alert modal implementation here
    }

    function hideKeywordsMissingModal() {
        // Hide your alert modal implementation here
    }

    // Function to display the modal and obtain the selected option
    async function showResultsModals() {
        const selectedOption = await showResultsModal();
        return selectedOption;
    }


    function processSelections(keywords) {
        // Create JSON string

        var keywordObj = {keywords: keywords};
        selections.push(keywordObj);
        var jsonString = JSON.stringify(selections, null, 0);

        // Create hidden input
        var hiddenInput = document.createElement('input');
        hiddenInput.setAttribute('type', 'hidden');
        hiddenInput.setAttribute('name', 'selections');
        hiddenInput.setAttribute('value', jsonString);
        hiddenInput.setAttribute('input_type', 'search');
        document.getElementById('runForm').appendChild(hiddenInput);


    }

    // Function to check if keywords are already present
    function checkKeywordsPresence() {
        var keywords = document.getElementById('keywords').value.trim();
        return keywords !== '';
    }

    // Function to wait for the input complete button click
    function waitForInputComplete() {
        return new Promise(function (resolve) {
            document.getElementById('inputComplete').addEventListener('click', function () {
                var keywords = document.getElementById('keywords').value.trim();
                resolve(keywords);
            });
        });
    }

    function CheckNRun() {

            // Call showResultsModals and obtain the selected option
            showResultsModals().then(function (selectedOption) {
                const resultstodisplay = selectedOption;
                addToCollection(selections, 'results', resultstodisplay);
                console.log("Selected option assigned to variable:", resultstodisplay);
                // Pass someSelection to another function or use it as needed

                // Check if keywords are already present
                if (checkKeywordsPresence()) {
                    // If keywords are already present, process selections directly
                    processSelections(document.getElementById('keywords').value.trim());
                    document.getElementById('runForm').submit();
                } else {
                    showKeyWordsMissingModal(); // Show alert modal for missing keywords
                    showInputCompleteButton();
                    // If keywords are not already present, wait for user input
                    // Call waitForInputComplete to wait for the input complete button click
                    waitForInputComplete().then(function (keywords) {
                        // Continue processing after the button click
                        console.log('Input complete button clicked with keywords:', keywords);
                        processSelections(keywords);
                        document.getElementById('run').submit();
                    });
                }


            });

    }

    function completeUserInput() {
        var keywords = document.getElementById('keywords').value.trim();
        processSelections(keywords);
    }

    function showAlertModal() {
        $('#selections_checker').modal('show');

        // Close the modal after 2 seconds
        setTimeout(function () {
            $('#selections_checker').modal('hide');
        }, 3000);
    }

    function showKeyWordsMissingModal() {
        $('#keywords_checker').modal('show');
        // Close the modal after 2 seconds
        setTimeout(function () {
            $('#keywords_checker').modal('hide');
        }, 3000);
    }




    // Assume this is triggered by some user action or event
    function keyword_processing() {
        var keywords = document.getElementById('keywords').value
        fetch('/api/keyword_processing', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
            },
            body: JSON.stringify({keywords}),
        })
            .then(response => response.json())
            .then(data => {
                updateTableRows(data['meaningful'], data['meaningless']);
                openModalwordTable();
                // Do something with the response from the Python function
            })
            .catch(error => console.error('Error:', error));
    }


    function updateTableRows(meaningful, meaningless) {
        const tableBody = document.querySelector('#wordTable tbody');

        // Clear existing rows
        tableBody.innerHTML = '';
        const maxRows = Math.max(meaningful.length, meaningless.length);
        // Add new rows based on 'meaningful' and 'meaningless' words
        for (let i = 0; i < maxRows; i++) {
            const row = tableBody.insertRow();
            row.style.cssText = '';

            // Insert cell for 'meaningful' words in the first column
            const cellMeaningful = row.insertCell(0);
            if (i < meaningful.length) {
                cellMeaningful.textContent = meaningful[i];
                cellMeaningful.style.cssText = '';
                cellMeaningful.classList.add('meaningful-word');
            }

            // Insert cell for 'meaningless' words in the second column
            const cellMeaningless = row.insertCell(1);
            if (i < meaningless.length) {
                cellMeaningless.textContent = meaningless[i];
                cellMeaningless.classList.add('meaningless-word');
            }
        }
    }
function selectedOption(item) {
    var div = item.parentNode;
    var button = item.parentNode.parentNode.querySelector('button');
    var elementid = button.getAttribute('id');
    document.getElementById(elementid).innerText = item.innerHTML
    div.classList.remove('hovered');
    var key_for_collection = button.id.split('_')[1]
    value = item.getAttribute('data-value')

            addToCollection(selections, key_for_collection, value)
    // Hide the dropdown after selection is made
    var dropdownContent = button.nextElementSibling;
    dropdownContent.classList.remove('show');
}
function showFileChooser() {
    var fileInput = document.getElementById('fileInput');
    event.stopPropagation();
    fileInput.click();

}

function toggleDropdownHover(isHovered) {
    //var elm = isHovered.getAttribute('id')
     if (isHovered) {
        isHovered.classList.add('hovered');
    } else {
        isHovered.classList.remove('hovered');
    }
}
// Function to toggle dropdown content visibility
function toggleDropdown(button) {
    var dropdownContent = button.nextElementSibling;
    dropdownContent.classList.toggle('show'); // Toggle visibility

    // Stop the default action of the click event
    event.preventDefault();
    event.stopPropagation();
}



// Function to handle file selection
function handleFileSelect(event) {
    var file = event.target.files[0];
    if (file) {
        var reader = new FileReader();
        reader.onload = function (e) {

            var lines = e.target.result.split('\n')
                         .filter(function (line) {
                             return line.trim() !== '';  // Trim and check if not empty
                         })
                         .slice(0, 60);

                     // Combine the lines into a single string with space delimiters
                     var content = lines.join(' ');

                     // Display in the keywords input
                     var keywordsInput = document.getElementById('keywords');
                     keywordsInput.value = content;
        };
        reader.readAsText(file);
    }
}


 function toggleDiv() {
  var toggleDiv = document.getElementById("compactview");
  if (toggleDiv.style.display === "block") {
    toggleDiv.style.display = "none";
  } else {
    toggleDiv.style.display = "block";
  }
}

function openModalwordTable() {
  var modal = document.getElementById("wordTable");
  modal.style.display = "block";
}

function closeModalWordTable() {
  var modal = document.getElementById("wordTable");
  modal.style.display = "none";
}


// Function to create and trigger file input element
function uploadFile() {
    var fileInput = document.createElement('input');
    fileInput.type = 'file';
    fileInput.accept = '.txt';
    fileInput.style.display = 'none'; // Hide the file input

    // Listen for the change event on the file input
    fileInput.addEventListener('change', handleFileSelect);

    // Append the file input to the document body
    document.body.appendChild(fileInput);

    // Trigger a click on the file input
    fileInput.click();
}

</script>


{% endblock javascripts %}